<div class="row g-3">
  <!-- Calendary Pick Date Column -->
  <div class="col-md-6">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="fw-bold mb-0">Selecionar Data</h6>
    </div>
    <p-datepicker
      [(ngModel)]="selectedDate"
      [defaultDate]="defaultDate"
      (onSelect)="onDateSelect($event)"
      (onClearClick)="clearDateSelection()"
      [inline]="true"
      dateFormat="dd/mm/yy"
      [showButtonBar]="false"
      [showClear]="true"
      styleClass="w-100 calendar-fix"
    >
      <ng-template pTemplate="date" let-date>
        <span
          [ngClass]="{
            'session-day': isSessionDay(date),
            'valid-action-day': isValidActionDay(date),
            'invalid-action-day': !isValidActionDay(date)
          }"
          >{{ date.day }}</span
        >
      </ng-template>
    </p-datepicker>

    <!-- MetaData -->
    <div class="mb-2">
      @if (minimalModuleTeachings && minimalModuleTeachings.length > 0) {
      <div class="card border-0 p-2">
        @for (mt of minimalModuleTeachings; track mt.moduleTeachingId){
        <div class="mb-2">
          <label class="small">{{
            (mt.moduleName | truncate : 40) || "Módulo"
          }}</label>
          <p-progressbar
            [value]="mt.scheduledPercent"
            [color]="mt.scheduledPercent < 100 ? 'black' : ''"
          />
        </div>
        }
      </div>
      } @else {
      <div class="card border-0 p-3 text-center">
        <small class="text-muted"
          >Ainda não foram atríbuidos Formadores aos Módulos...</small
        >
      </div>
      }
    </div>
  </div>
  <!-- Sessions List Column -->
  <div class="col-md-6">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="fw-bold mb-0">
        @if (selectedDate) { Sessões para
        {{ selectedDate | date : "dd/MM/yyyy" }} ({{ filteredSessions.length }})
        } @else { Todas as Sessões ({{ filteredSessions.length }}) }
      </h6>
      <!-- Clear date selection button -->
      @if (canPerformAction()) {
      <div class="actions">
        @if (selectedDate) {
        <p-button
          class="me-2"
          icon="pi pi-filter-slash"
          size="small"
          severity="primary"
          [outlined]="true"
          (onClick)="clearDateSelection()"
          pTooltip="Limpar seleção e mostrar todas as sessões"
        >
        </p-button>
        }
        <p-button
          label="Nova Sessão"
          icon="pi pi-plus"
          size="small"
          (onClick)="onCreateSession()"
        >
        </p-button>
      </div>
      }
    </div>

    <!-- Sessions List -->
    <div class="sessions-container">
      @if (filteredSessions.length > 0) {
      <div class="sessions-list">
        @for (session of filteredSessions; track session.id) {
        <p-card class="session-card mb-3">
          <ng-template pTemplate="header">
            <div
              class="d-flex justify-content-between align-items-center bg-green-white p-2"
            >
              <div>
                <h6 class="mb-0 text-success">
                  {{ session.moduleName || "Sessão" }}
                </h6>
                <small class="mb-0">
                  {{ session.scheduledDate | date : "dd/MM/yyyy" }}
                </small>
              </div>
              <div style="min-width: 100px">
                @if (canPerformAction()) {
                <p-button
                  icon="pi pi-pencil"
                  size="small"
                  severity="warn"
                  [text]="true"
                  (onClick)="onUpdateSession(session)"
                  pTooltip="Editar Sessão"
                >
                </p-button>
                <p-button
                  icon="pi pi-trash"
                  size="small"
                  severity="danger"
                  [text]="true"
                  class="ms-1"
                  (onClick)="onDeleteSession(session)"
                  pTooltip="Excluir Sessão"
                >
                </p-button>
                }
                <p-button
                  icon="pi pi-calendar"
                  [text]="true"
                  size="small"
                  severity="secondary"
                  (click)="onScheduledDateClicked(session.scheduledDate)"
                />
              </div>
            </div>
          </ng-template>

          <!-- Session time start - end -->
          <div class="row g-2 small">
            <div class="col-12">
              <strong>Formador:</strong>
              <p class="mb-0">
                {{ session.teacherPersonName || "N/A" }}
              </p>
            </div>
            <div class="col-6">
              <strong>Presença:</strong>
              <p
                class="mb-1 text-{{
                  getPresenceSeverity(session.teacherPresence)
                }}"
              >
                {{ session.teacherPresence || "N/A" }}
              </p>
            </div>
            <div class="col-6">
              <strong>Horário:</strong>
              <p class="mb-1">{{ session.time }}</p>
            </div>
            <div class="col-6">
              <strong>Duração:</strong>
              <p class="mb-1">{{ session.durationHours }}h</p>
            </div>
            <div class="col-6">
              <strong>Dia da Semana:</strong>
              <p class="mb-1">{{ session.weekday }}</p>
            </div>
            <div class="col-12">
              <strong>Observação:</strong>
              <p class="mb-1">{{ session.note }}</p>
            </div>
          </div>
        </p-card>
        }
      </div>
      } @else {
      <p-card>
        <div class="text-center py-4">
          @if (selectedDate) {
          <i class="bi bi-calendar-x fs-1 text-muted"></i>
          <h6 class="mt-3 text-muted">Nenhuma sessão nesta data</h6>
          <p class="text-muted">
            Não há sessões agendadas para
            {{ selectedDate | date : "dd/MM/yyyy" }}.
          </p>
          } @else {
          <i class="bi bi-calendar-x fs-1 text-muted"></i>
          <h6 class="mt-3 text-muted">Nenhuma sessão agendada</h6>
          <p class="text-muted">
            Ainda não há sessões agendadas para esta ação.
          </p>
          } @if (canPerformAction()) {
          <p-button
            label="Nova Sessão"
            icon="pi pi-plus"
            severity="secondary"
            size="small"
            (onClick)="onCreateSession()"
          >
          </p-button>
          }
        </div>
      </p-card>
      }
    </div>
  </div>
</div>
