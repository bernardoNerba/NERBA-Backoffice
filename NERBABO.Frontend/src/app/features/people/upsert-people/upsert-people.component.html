<div class="modal-header">
  <h4 class="modal-title">{{ isUpdate ? "Atualizar" : "Registar" }} Pessoa</h4>
  <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="bsModalRef.hide()"
  ></button>
</div>
<div class="modal-body">
  <form [formGroup]="form">
    <div class="container">
      <div class="row">
        <!-- first name -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="firstName"
              >Nome Próprio
              <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              pInputText
              formControlName="firstName"
              [class.is-invalid]="submitted && form.get('firstName')?.errors"
              class="w-100 {{
                submitted && form.get('firstName')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('firstName')?.hasError("required")) {
            <span class="text-danger">
              Nome Próprio é um campo obrigatório.
            </span>
            } @else if (submitted &&
            form.get('firstName')?.hasError("minlength") ||
            form.get('firstName')?.hasError("maxlength")) {
            <span class="text-danger">
              Nome Próprio deve ter entre 3 e 100 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- end firstName -->

        <!-- last name -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="lastName"
              >Último Nome
              <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              pInputText
              formControlName="lastName"
              [class.is-invalid]="submitted && form.get('lastName')?.errors"
              class="w-100 {{
                submitted && form.get('lastName')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('lastName')?.hasError("required")) {
            <span class="text-danger">
              Último Nome é um campo obrigatório.
            </span>
            } @else if (submitted && form.get('lastName')?.hasError("minlength")
            || form.get('lastName')?.hasError("maxlength")) {
            <span class="text-danger">
              Último Nome deve ter entre 3 e 100 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- end last name -->

        <!-- NIF -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="nif"
              >NIF
              <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              pInputText
              formControlName="nif"
              [class.is-invalid]="submitted && form.get('nif')?.errors"
              class="w-100 {{
                submitted && form.get('nif')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('nif')?.hasError("required")) {
            <span class="text-danger"> NIF é um campo obrigatório. </span>
            } @else if (submitted && form.get('nif')?.hasError("minlength") ||
            form.get('nif')?.hasError("maxlength")) {
            <span class="text-danger">
              NIF deve ter extamente 9 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END NIF -->

        <!-- NISS -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="niss">NISS</label>
            <input
              type="text"
              pInputText
              formControlName="niss"
              [class.is-invalid]="submitted && form.get('niss')?.errors"
              class="w-100 {{
                submitted && form.get('niss')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('niss')?.hasError("required")) {
            <span class="text-danger"> NISS é um campo obrigatório. </span>
            } @else if (submitted && form.get('niss')?.hasError("minlength") ||
            form.get('niss')?.hasError("maxlength")) {
            <span class="text-danger">
              NISS deve ter extamente 11 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END NISS -->

        <!-- Numero de Identificação -->
        <div class="col-md-12">
          <div class="mb-3">
            <label for="identificationNumber">Número de Identificação </label>
            <input
              type="text"
              pInputText
              formControlName="identificationNumber"
              [class.is-invalid]="
                submitted && form.get('identificationNumber')?.errors
              "
              class="w-100 {{
                submitted && form.get('identificationNumber')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted &&
            form.get('identificationNumber')?.hasError("required")) {
            <span class="text-danger">
              Número de Identificação é um campo obrigatório.
            </span>
            } @else if (submitted &&
            form.get('identificationNumber')?.hasError("minlength") ||
            form.get('identificationNumber')?.hasError("maxlength")) {
            <span class="text-danger">
              Número de Identificação entre 5 e 10 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Numero de Identificação -->

        <!-- Identification Type -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="identificationType">Tipo de Identificação</label>
            <p-select
              formControlName="identificationType"
              [options]="allIdentificationTypes"
              optionLabel="value"
              optionValue="value"
              placeholder="Selecione um tipo..."
              styleClass="w-100"
              [class.is-invalid]="
                submitted && form.get('identificationType')?.errors
              "
              class="{{
                submitted && form.get('identificationType')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted &&
            form.get('identificationType')?.hasError("required")) {
            <span class="text-danger">
              Tipo de Identificação é um campo obrigatório.
            </span>
            }
          </div>
        </div>
        <!-- END Identification Type -->

        <!-- Identification Validation Date -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="identificationValidationDate">Data Validade NI</label>
            <p-datepicker
              formControlName="identificationValidationDate"
              [showIcon]="true"
              inputId="identificationValidationDate"
              [showOnFocus]="false"
              placeholder="dia/mes/ano"
              dataType="string"
              dateFormat="dd/mm/yy"
              styleClass="w-100"
              [class.is-invalid]="
                submitted && form.get('identificationValidationDate')?.errors
              "
              class="{{
                submitted && form.get('identificationValidationDate')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted &&
            form.get('identificationValidationDate')?.hasError("required")) {
            <span class="text-danger">
              Data de Validação do Documento é um campo obrigatório.
            </span>
            }
          </div>
        </div>
        <!-- END Identification Validation Date -->

        <!-- IBAN -->
        <div class="col-md-12">
          <div class="mb-3">
            <label for="iban">IBAN</label>
            <input
              type="text"
              pInputText
              formControlName="iban"
              [class.is-invalid]="submitted && form.get('iban')?.errors"
              class="w-100 {{
                submitted && form.get('iban')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('iban')?.hasError("required")) {
            <span class="text-danger"> IBAN é um campo obrigatório. </span>
            } @else if (submitted && form.get('iban')?.hasError("minlength") ||
            form.get('iban')?.hasError("maxlength")) {
            <span class="text-danger">
              IBAN deve ter extamente 25 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END IBAN -->

        <!-- Gender -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="gender">Gênero</label>
            <p-select
              formControlName="gender"
              [options]="allGender"
              optionLabel="value"
              optionValue="value"
              placeholder="Selecione um genero..."
              styleClass="w-100"
              [class.is-invalid]="submitted && form.get('gender')?.errors"
              class="{{
                submitted && form.get('gender')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('gender')?.hasError("required")) {
            <span class="text-danger"> Gênero é um campo obrigatório. </span>
            }
          </div>
        </div>
        <!-- END Gender -->

        <!-- Habilitation -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="habilitation">Habilitação</label>
            <p-select
              formControlName="habilitation"
              [options]="allHabilitations"
              optionLabel="value"
              optionValue="value"
              placeholder="Selecione uma habilitação..."
              styleClass="w-100"
              [class.is-invalid]="submitted && form.get('habilitation')?.errors"
              class="{{
                submitted && form.get('habilitation')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('habilitation')?.hasError("required")) {
            <span class="text-danger">
              Habilitação é um campo obrigatório.
            </span>
            }
          </div>
        </div>
        <!-- END Habilitation -->

        <!-- Address -->
        <div class="col-md-12">
          <div class="mb-3">
            <label for="address">Morada</label>
            <textarea
              formControlName="address"
              rows="3"
              pTextarea
              [class.is-invalid]="submitted && form.get('address')?.errors"
              class="w-100 {{
                submitted && form.get('address')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            ></textarea>
            @if (submitted && form.get('address')?.hasError("required")) {
            <span class="text-danger"> Morada é um campo obrigatório. </span>
            }
          </div>
        </div>
        <!-- END Address -->

        <!-- Postal Code -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="zipCode">Código Postal</label>
            <input
              type="text"
              pInputText
              formControlName="zipCode"
              [class.is-invalid]="submitted && form.get('zipCode')?.errors"
              class="w-100 {{
                submitted && form.get('zipCode')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('zipCode')?.hasError("required")) {
            <span class="text-danger">
              Código Postal é um campo obrigatório.
            </span>
            } @else if (submitted && form.get('zipCode')?.hasError("minlength")
            || form.get('zipCode')?.hasError("maxlength")) {
            <span class="text-danger">
              Código Postal deve ter extamente 8 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Postal Code -->

        <!-- Birth Date -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="birthDate">Data de Nascimento</label>
            <p-datepicker
              formControlName="birthDate"
              [showIcon]="true"
              inputId="birthDate"
              [showOnFocus]="false"
              placeholder="dia/mes/ano"
              dateFormat="dd/mm/yy"
              dataType="string"
              styleClass="w-100"
              [class.is-invalid]="submitted && form.get('birthDate')?.errors"
              class="{{
                submitted && form.get('birthDate')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('birthDate')?.hasError("required")) {
            <span class="text-danger">
              Data de Nascimento é um campo obrigatório.
            </span>
            }
          </div>
        </div>
        <!-- END Birth Date -->

        <!-- Phone Number -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="phoneNumber">Número de Telefone</label>
            <input
              type="text"
              pInputText
              formControlName="phoneNumber"
              [class.is-invalid]="submitted && form.get('phoneNumber')?.errors"
              class="w-100 {{
                submitted && form.get('phoneNumber')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('phoneNumber')?.hasError("required")) {
            <span class="text-danger">
              Número de Telefone é um campo obrigatório.
            </span>
            } @else if (submitted &&
            form.get('phoneNumber')?.hasError("minlength") ||
            form.get('phoneNumber')?.hasError("maxlength")) {
            <span class="text-danger">
              Número de Telefone deve ter extamente 9 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Phone Number -->

        <!-- Email -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="email">Email</label>
            <input
              type="text"
              pInputText
              formControlName="email"
              [class.is-invalid]="submitted && form.get('email')?.errors"
              class="w-100 {{
                submitted && form.get('email')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('email')?.hasError("required")) {
            <span class="text-danger"> Email é um campo obrigatório. </span>
            } @else if (submitted && form.get('email')?.hasError("email")) {
            <span class="text-danger"> Por favor insira um email válido. </span>
            } @else if (submitted && (form.get('email')?.hasError("minlength")
            || form.get('email')?.hasError("maxlength"))) {
            <span class="text-danger">
              Email deve ter entre 5 e 50 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Email -->

        <!-- Naturality -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="naturality">Naturalidade</label>
            <input
              type="text"
              pInputText
              formControlName="naturality"
              [class.is-invalid]="submitted && form.get('naturality')?.errors"
              class="w-100 {{
                submitted && form.get('naturality')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('naturality')?.hasError("required")) {
            <span class="text-danger">
              Naturalidade é um campo obrigatório.
            </span>
            } @else if (submitted &&
            (form.get('naturality')?.hasError("minlength") ||
            form.get('naturality')?.hasError("maxlength"))) {
            <span class="text-danger">
              Naturalidade deve ter entre 3 e 100 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Naturality -->

        <!-- Nationality -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="nationality">Nacionalidade</label>
            <p-autocomplete
              formControlName="nationality"
              [suggestions]="filteredCountries"
              (completeMethod)="filterCountry($event)"
              optionLabel="gentilico"
              optionValue="gentilico"
              [dropdown]="true"
              [class.is-invalid]="submitted && form.get('nationality')?.errors"
              styleClass="w-100"
              class="{{
                submitted && form.get('nationality')?.errors
                  ? 'ng-invalid ng-dirty'
                  : ''
              }}"
            />
            @if (submitted && form.get('nationality')?.hasError("required")) {
            <span class="text-danger">
              Nacionalidade é um campo obrigatório.
            </span>
            } @else if (submitted &&
            (form.get('nationality')?.hasError("minlength") ||
            form.get('nationality')?.hasError("maxlength"))) {
            <span class="text-danger">
              Nacionalidade deve ter entre 3 e 100 caracteres.
            </span>
            }
          </div>
        </div>
        <!-- END Nationality -->
      </div>
    </div>

    <app-error-card [errors]="errorMessages" [submitted]="submitted" />
  </form>
</div>
<div class="modal-footer">
  <!-- submit button -->
  <div class="text-end">
    <button type="button" class="btn-gray me-2" (click)="bsModalRef.hide()">
      Cancel
    </button>
    <button
      type="submit"
      class="btn-main"
      [disabled]="loading"
      (click)="onSubmit()"
    >
      @if (loading){
      <span class="spinner-border spinner-border-sm me-1"></span>
      } Save
    </button>
  </div>
</div>
